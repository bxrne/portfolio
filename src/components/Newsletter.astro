---
import Checkbox from "@components/Checkbox.astro";
---

<link href="https://e.sensorpro.net/ScriptCache/SensorPro_RegForm.css" rel="stylesheet">

<form name="sensorProForm" id="sensorProForm" method="post" autocomplete="off" class="flex flex-col gap-4 w-full md:w-auto" action="https://e.sensorpro.net/Run/Subscribe.aspx?fid=qzuo78qt%2FWe0h72YktFkNhkbYlylUGhWl1g%2BQov7mo2ZS5WO5UkSig%3D%3D_stzh" target="_blank">
  <div class="flex items-center gap-4 w-full">
    <input
      type="email"
      name="spro_email"
      id="spro_email"
      placeholder="email@newsletter.com"
      class="flex-1 px-4 py-2 border border-terminal-border text-terminal-fg bg-terminal-bg/60 focus:outline-none focus:ring-0 text-md placeholder:text-terminal-muted"
      required
    >
    <button
      type="button"
      id="Spro-Btn-Signup-StyleNo"
      onclick="event.preventDefault(); if(window.SensorProForms) { SensorProForms.initialize('RegForm','https://e.sensorpro.net/Run/Subscribe.aspx?fid=qzuo78qt%2FWe0h72YktFkNhkbYlylUGhWl1g%2BQov7mo2ZS5WO5UkSig%3D%3D_stzh',''); SensorProForms.submitForm(false); } else { this.form.submit(); }"
      class="px-4 py-2 border border-terminal-accent text-terminal-accent bg-terminal-accent-soft/40 hover:bg-terminal-accent-soft focus:outline-none focus:ring-0 text-md font-medium whitespace-nowrap transition-colors"
    >
     Subscribe 
    </button>
  </div>
   <Checkbox id="spro_consent" name="spro_consent" required={true} label="I want emails!" />
  <div id="sensorProMsg" class="text-red-600 text-sm mt-2 hidden"></div>
</form>

<script is:inline>
if (!window.SensorProForms) {
  const script = document.createElement("script");
  script.src = "https://e.sensorpro.net/ScriptCache/SensorPro_RegForm.js";
  script.onload = () => {
    console.log("SensorPro script loaded");
    // Override SensorPro submit to use native form submission
    if (window.SensorProForms) {
      window.SensorProForms.submitForm = function(cookie) {
        if (window.SensorProForms.validateForm()) {
          if (cookie) {
            window.SensorProForms.dropSignupCookie("sproSignupModal", "signup", 0);
          }
          // Use native form submission instead of document.form.submit()
          const form = document.getElementById("sensorProForm");
          if (form && form instanceof HTMLFormElement) {
            form.submit();
          }
        }
      };
    }
  };
  script.onerror = () => {
    console.error("Failed to load SensorPro script");
  };
  document.head.appendChild(script);
}
</script>
