---
import Checkbox from "@components/Checkbox.astro";
---

<link href="https://e.sensorpro.net/ScriptCache/SensorPro_RegForm.css" rel="stylesheet">

<form name="sensorProForm" id="sensorProForm" method="post" autocomplete="off" class="flex flex-col gap-4 w-full " action="https://e.sensorpro.net/Run/Subscribe.aspx?fid=qzuo78qt%2FWe0h72YktFkNhkbYlylUGhWl1g%2BQov7mo2ZS5WO5UkSig%3D%3D_stzh" target="_blank">
  <div class="flex items-center gap-4 w-full">
    <input
      type="email"
      name="spro_email"
      id="spro_email"
      placeholder="email@newsletter.com"
      class="flex-1 px-4 py-2 border-2 border-black text-black bg-transparent focus:outline-none focus:ring-0 text-md placeholder:text-gray-500"
      required
    >
    <button
      type="button"
      id="Spro-Btn-Signup-StyleNo"
      onclick="event.preventDefault(); if(window.SensorProForms) { SensorProForms.initialize('RegForm','https://e.sensorpro.net/Run/Subscribe.aspx?fid=qzuo78qt%2FWe0h72YktFkNhkbYlylUGhWl1g%2BQov7mo2ZS5WO5UkSig%3D%3D_stzh',''); SensorProForms.submitForm(false); } else { this.form.submit(); }"
      class="px-4 py-2 border-2 border-black text-black bg-transparent hover:bg-black/5 focus:outline-none focus:ring-0 text-md font-medium whitespace-nowrap transition-colors"
    >
     Subscribe 
    </button>
  </div>
   <Checkbox id="spro_consent" name="spro_consent" required={true} label="I want emails!" />
  <div id="sensorProMsg" class="text-red-600 text-sm mt-2 hidden"></div>
</form>

<script is:inline>
// @ts-ignore
if (!window.SensorProForms) {
  const script = document.createElement('script');
  script.src = 'https://e.sensorpro.net/ScriptCache/SensorPro_RegForm.js';
  script.onload = () => {
    console.log('SensorPro script loaded');
    // Override SensorPro submit to use native form submission
    if (window.SensorProForms) {
      const originalSubmit = window.SensorProForms.submitForm;
      window.SensorProForms.submitForm = function(cookie) {
        if (window.SensorProForms.validateForm()) {
          if (cookie) {
            window.SensorProForms.dropSignupCookie('sproSignupModal', 'signup', 0);
          }
          // Use native form submission instead of document.form.submit()
          const form = document.getElementById('sensorProForm');
          if (form && form instanceof HTMLFormElement) {
            form.submit();
          }
        }
      };
    }
  };
  script.onerror = () => {
    console.error('Failed to load SensorPro script');
  };
  document.head.appendChild(script);
}
</script>

<style>
  form {
    position: relative;
  }
  form::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgb(251, 241, 199);
    transform: translate(2px, 2px);
    z-index: -1;
  }


</style>
