---
import { getCollection } from "astro:content";
import Container from "@components/Container.astro";
import PageLayout from "@layouts/PageLayout.astro";
import ArrowCard from "@components/ArrowCard.astro";
import Link from "@components/Link.astro";
import Newsletter from "@components/Newsletter.astro";
import { dateRange } from "@lib/utils";
import { SITE, HOME, SOCIALS } from "@consts";

const blog = (await getCollection("blog"))
  .filter(post => !post.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0,SITE.NUM_POSTS_ON_HOMEPAGE);

const projects = (await getCollection("projects"))
  .filter(project => !project.data.draft)
  .sort((a, b) => new Date(b.data.date).valueOf() - new Date(a.data.date).valueOf())
  .slice(0,SITE.NUM_PROJECTS_ON_HOMEPAGE);

const allwork = (await getCollection("work"))
  .sort((a, b) => new Date(b.data.dateStart).valueOf() - new Date(a.data.dateStart).valueOf())
  .slice(0,SITE.NUM_WORKS_ON_HOMEPAGE);

const work = await Promise.all(
  allwork.map(async (item) => {
    const { Content } = await item.render();
    return { ...item, Content };
  })
);

---

<PageLayout title={HOME.TITLE} description={HOME.DESCRIPTION}>
  <Container>
    <div class="space-y-12">
      <!-- Intro Section -->
      <section class="border-b border-neutral-200 pb-8">
        <div class="space-y-4">
          <p class="text-sm text-neutral-700 leading-relaxed font-mono">
            Interested in software and distributed systems. I've worked in MedTech developing MES integrations and observability tooling for factory automation, built AI analysis platforms for investment fund software, and worked on radar vision ML in ADAS projects. In robotics, I developed teleoperation tools and simulation environments for industrial arms and created performance benchmarks for computer vision models. I've led payloads for competition rockets, including deployable CanSats running edge AI and real-time telemetry.
          </p>
          <p class="text-xs text-neutral-500 font-mono">
            Stack: Go · TypeScript · Python · Bash · C · C++ · Lua · Kubernetes · Helm · Linux · Terraform
          </p>
          <p class="text-xs text-neutral-500 font-mono">
            Currently learning: OCaml
          </p>
        </div>
      </section>

      <!-- Projects Section -->
      <section class="space-y-4">
        <div class="flex items-baseline justify-between border-b border-black pb-1">
          <h2 class="font-mono text-xs uppercase tracking-wider font-bold">
            Recent Projects
          </h2>
          <Link href="/projects">
            <span class="text-xs">View all →</span>
          </Link>
        </div>
        <ul class="space-y-1">
          {projects.map(project => (
            <li>
              <ArrowCard entry={project} />
            </li>
          ))}
        </ul>
      </section>

      <!-- Blog Posts Section -->
      <section class="space-y-4">
        <div class="flex items-baseline justify-between border-b border-black pb-1">
          <h2 class="font-mono text-xs uppercase tracking-wider font-bold">
            Latest Posts
          </h2>
          <Link href="/blog">
            <span class="text-xs">View all →</span>
          </Link>
        </div>
        <ul class="space-y-1">
          {blog.map(post => (
            <li>
              <ArrowCard entry={post} />
            </li>
          ))}
        </ul>
      </section>

      <!-- Work Experience Section -->
      <section class="space-y-4">
        <div class="flex items-baseline justify-between border-b border-black pb-1">
          <h2 class="font-mono text-xs uppercase tracking-wider font-bold">
            Work Experience
          </h2>
          <Link href="/work">
            <span class="text-xs">View all →</span>
          </Link>
        </div>
        <ul class="space-y-6">
          {work.map(entry => (
            <li class="border-l-2 border-neutral-200 pl-3">
              <div class="text-xs text-neutral-500 font-mono mb-1">
                {dateRange(entry.data.dateStart, entry.data.dateEnd)}
              </div>
              <div class="font-mono text-sm font-bold text-black">
                {entry.data.company}
              </div>
              <div class="text-xs text-neutral-600 font-mono mb-2">
                {entry.data.role}
              </div>
              <article class="text-xs">
                <entry.Content />
              </article>
            </li>
          ))}
        </ul>
      </section>

      <!-- Contact Section -->
      <section class="space-y-4 border-t border-neutral-200 pt-8">
        <h2 class="font-mono text-xs uppercase tracking-wider font-bold border-b border-black pb-1">
          Contact
        </h2>
        <p class="text-xs text-neutral-700 font-mono">
          Reach out on social media or send an email.
        </p>
        <div class="grid grid-cols-2 gap-x-8 gap-y-2 text-xs font-mono">
          {SOCIALS.map(SOCIAL => (
            <div class="flex items-baseline gap-2">
              <span class="text-neutral-400">→</span>
              <Link href={SOCIAL.HREF} external aria-label={`${SITE.NAME} on ${SOCIAL.NAME}`}>
                {SOCIAL.NAME}
              </Link>
            </div>
          ))}
          <div class="flex items-baseline gap-2">
            <span class="text-neutral-400">→</span>
            <Link href={`mailto:${SITE.EMAIL}`} aria-label={`Email ${SITE.NAME}`}>
              Email
            </Link>
          </div>
          <div class="flex items-baseline gap-2">
            <span class="text-neutral-400">→</span>
            <Link href="/resume.pdf" external aria-label={`${SITE.NAME} CV`}>
              Resume (PDF)
            </Link>
          </div>
        </div>
      </section>
    </div>
  </Container>
</PageLayout>
