---
import { getCollection } from "astro:content";
import Container from "@components/Container.astro";
import PageLayout from "@layouts/PageLayout.astro";
import ArrowCard from "@components/ArrowCard.astro";
import Link from "@components/Link.astro";
import Newsletter from "@components/Newsletter.astro";
import { dateRange } from "@lib/utils";
import { SITE, HOME, SOCIALS } from "@consts";

const blog = (await getCollection("blog"))
  .filter(post => !post.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0,SITE.NUM_POSTS_ON_HOMEPAGE);

const projects = (await getCollection("projects"))
  .filter(project => !project.data.draft)
  .sort((a, b) => new Date(b.data.date).valueOf() - new Date(a.data.date).valueOf())
  .slice(0,SITE.NUM_PROJECTS_ON_HOMEPAGE);

const allwork = (await getCollection("work"))
  .sort((a, b) => new Date(b.data.dateStart).valueOf() - new Date(a.data.dateStart).valueOf())
  .slice(0,SITE.NUM_WORKS_ON_HOMEPAGE);

const work = await Promise.all(
  allwork.map(async (item) => {
    const { Content } = await item.render();
    return { ...item, Content };
  })
);

---

<PageLayout title={HOME.TITLE} description={HOME.DESCRIPTION}>
  <Container>
    <div class="space-y-12">
      <!-- Intro Section -->
      <section class="border border-black dark:border-white p-6 bg-neutral-50 dark:bg-neutral-900">
        <div class="space-y-4">
          <p class="text-sm text-neutral-700 dark:text-neutral-300 leading-relaxed font-mono">
            Interested in software and distributed systems. I've worked in MedTech developing MES integrations and observability tooling for factory automation, built AI analysis platforms for investment fund software, and worked on radar vision ML in ADAS projects. In robotics, I developed teleoperation tools and simulation environments for industrial arms and created performance benchmarks for computer vision models. I've led payloads for competition rockets, including deployable CanSats running edge AI and real-time telemetry.
          </p>
          <div class="border-t border-neutral-200 dark:border-neutral-800 pt-4 space-y-2">
            <p class="text-xs text-neutral-500 dark:text-neutral-400 font-mono">
              <span class="text-black dark:text-white font-bold">STACK:</span> Go · TypeScript · Python · Bash · C · C++ · Lua · Kubernetes · Helm · Linux · Terraform
            </p>
            <p class="text-xs text-neutral-500 dark:text-neutral-400 font-mono">
              <span class="text-black dark:text-white font-bold">CURRENT:</span> Building a temporal database in Zig
            </p>
          </div>
        </div>
      </section>

      <!-- Projects Section -->
      <section class="space-y-4">
        <div class="flex items-baseline justify-between border-b-2 border-black dark:border-white pb-1 mb-2">
          <h2 class="font-mono text-xs uppercase tracking-wider font-bold">
            [01] Recent Projects
          </h2>
          <Link href="/projects">
            <span class="text-xs">View all →</span>
          </Link>
        </div>
        <ul class="space-y-1">
          {projects.map(project => (
            <li>
              <ArrowCard entry={project} />
            </li>
          ))}
        </ul>
      </section>

      <!-- Blog Posts Section -->
      <section class="space-y-4">
        <div class="flex items-baseline justify-between border-b-2 border-black dark:border-white pb-1 mb-2">
          <h2 class="font-mono text-xs uppercase tracking-wider font-bold">
            [02] Latest Posts
          </h2>
          <Link href="/blog">
            <span class="text-xs">View all →</span>
          </Link>
        </div>
        <ul class="space-y-1">
          {blog.map(post => (
            <li>
              <ArrowCard entry={post} />
            </li>
          ))}
        </ul>
      </section>

      <!-- Work Experience Section -->
      <section class="space-y-4 border border-black dark:border-white p-4 bg-neutral-50 dark:bg-neutral-900">
        <div class="flex items-baseline justify-between border-b-2 border-black dark:border-white pb-1 mb-2">
          <h2 class="font-mono text-xs uppercase tracking-wider font-bold">
            [03] Work Experience
          </h2>
          <Link href="/work">
            <span class="text-xs">View all →</span>
          </Link>
        </div>
        <ul class="space-y-6">
          {work.map(entry => (
            <li class="border-l-2 border-neutral-300 dark:border-neutral-700 pl-3">
              <div class="text-xs text-neutral-500 dark:text-neutral-400 font-mono mb-1">
                {dateRange(entry.data.dateStart, entry.data.dateEnd)}
              </div>
              <div class="font-mono text-sm font-bold text-black dark:text-white">
                {entry.data.company}
              </div>
              <div class="text-xs text-neutral-600 dark:text-neutral-400 font-mono mb-2">
                {entry.data.role}
              </div>
              <article class="text-xs">
                <entry.Content />
              </article>
            </li>
          ))}
        </ul>
      </section>

      <!-- Contact Section -->
      <section class="space-y-4 border-t-2 border-black dark:border-white pt-8">
        <h2 class="font-mono text-xs uppercase tracking-wider font-bold border-b-2 border-black dark:border-white pb-1">
          [04] Contact
        </h2>
        <p class="text-xs text-neutral-700 dark:text-neutral-300 font-mono">
          Reach out on social media or send an email.
        </p>
        <div class="grid grid-cols-2 gap-x-8 gap-y-2 text-xs font-mono">
          {SOCIALS.map(SOCIAL => (
            <div class="flex items-baseline gap-2">
              <span class="text-neutral-400 dark:text-neutral-600">→</span>
              <Link href={SOCIAL.HREF} external aria-label={`${SITE.NAME} on ${SOCIAL.NAME}`}>
                {SOCIAL.NAME}
              </Link>
            </div>
          ))}
          <div class="flex items-baseline gap-2">
            <span class="text-neutral-400 dark:text-neutral-600">→</span>
            <Link href={`mailto:${SITE.EMAIL}`} aria-label={`Email ${SITE.NAME}`}>
              Email
            </Link>
          </div>
          <div class="flex items-baseline gap-2">
            <span class="text-neutral-400 dark:text-neutral-600">→</span>
            <Link href="/resume.pdf" external aria-label={`${SITE.NAME} CV`}>
              Resume (PDF)
            </Link>
          </div>
        </div>
      </section>
    </div>
  </Container>
</PageLayout>
